#include "card_formatter.h"

void format_serial_hex_7bytes(uint64_t data, uint8_t bit_count) {
    printf("üîë Correct HEX: ");
    
    uint8_t bytes[7];
    // 1. –†–∞–∑–±–∏—Ä–∞–µ–º —á–∏—Å–ª–æ –Ω–∞ –±–∞–π—Ç—ã (Big Endian –ø–æ—Ä—è–¥–æ–∫: –±–∞–π—Ç 0 - —Å—Ç–∞—Ä—à–∏–π)
    // –≠—Ç–æ –¥–∞–µ—Ç –Ω–∞–º –º–∞—Å—Å–∏–≤ –≤–∏–¥–∞ {00, 00, 00, B1, 32, A2, E9}
    for (int i = 0; i < 7; i++) {
        bytes[i] = (data >> ((6 - i) * 8)) & 0xFF;
    }

    int data_start_idx = 7; // –ò–Ω–¥–µ–∫—Å, –≥–¥–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ (–Ω–µ –Ω—É–ª–∏)

    // 2. –í—ã–≤–æ–¥–∏–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –°–õ–ï–í–ê (00:00:00:)
    for (int i = 0; i < 7; i++) {
        if (bytes[i] != 0) {
            data_start_idx = i;
            break; // –ù–∞—à–ª–∏ –Ω–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–≤–æ–¥ –Ω—É–ª–µ–π
        }
        printf("%02X:", bytes[i]);
    }

    // 3. –í—ã–≤–æ–¥–∏–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –û–ë–†–ê–¢–ù–û–ú –ø–æ—Ä—è–¥–∫–µ (E9:A2:32:B1)
    // –ò–¥–µ–º —Å –∫–æ–Ω—Ü–∞ –º–∞—Å—Å–∏–≤–∞ (6) –¥–æ –Ω–∞—á–∞–ª–∞ –¥–∞–Ω–Ω—ã—Ö (data_start_idx)
    for (int i = 6; i >= data_start_idx; i--) {
        printf("%02X", bytes[i]);
        if (i > data_start_idx) printf(":"); // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
    }
    
    printf("\n");
}